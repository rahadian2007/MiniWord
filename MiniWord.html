<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>MiniWord</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }

    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    /* HEADER */
    .header {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 10px;
    }

    #editor {
      width: 30%;
      height: 420px;
      border: 4px solid #ccc;
      padding: 10px;
      overflow-y: auto;
      font-size: 14px;
    }

    .button-group,
    .select-group {
      display: flex;
      justify-content: center;
      margin-top: 10px;
    }

    button, select {
      margin-right: 5px;
      padding: 6px 10px;
    }
  </style>
</head>
<body>

<div class="container">

  <div class="header">
     MiniWord â€” by <a href="https://portofolio-juni2025.pages.dev/" target="_blank">Rahadian</a> Jan 2026
  </div>


  <div id="editor"
       contenteditable="true"
       spellcheck="false"
       autocorrect="off"
       autocapitalize="off">
  </div>

  <div class="button-group">
    <button onclick="save()">Save</button>
    <button onclick="saveAs()">Save As</button>
    <button onclick="deleteFile()">Delete</button>
  </div>

  <div class="select-group">
    <select id="fileList" onchange="openFile()">
      <option value="">Open...</option>
    </select>
  </div>

</div>

<script>
let db;
let currentId = null;

const request = indexedDB.open("RichTextDB", 1);

request.onupgradeneeded = e => {
  db = e.target.result;
  db.createObjectStore("files", { keyPath: "id", autoIncrement: true });
};

request.onsuccess = e => {
  db = e.target.result;
  loadFiles();
};

function save() {
  if (currentId === null) {
    saveAs();
    return;
  }

  const tx = db.transaction("files", "readwrite");
  const store = tx.objectStore("files");

  store.put({
    id: currentId,
    data: getData()
  });

  alert("Disimpan");
}

function saveAs() {
  const tx = db.transaction("files", "readwrite");
  const store = tx.objectStore("files");

  store.add({
    data: getData()
  });

  tx.oncomplete = () => {
    currentId = null;
    loadFiles();
    alert("Disimpan sebagai baru");
  };
}

function openFile() {
  const id = Number(document.getElementById("fileList").value);
  if (!id) return;

  const tx = db.transaction("files", "readonly");
  const store = tx.objectStore("files");

  store.get(id).onsuccess = e => {
    currentId = id;
    document.getElementById("editor").innerHTML =
      e.target.result.data.html;
  };
}

function deleteFile() {
  if (currentId === null) {
    alert("Tidak ada file yang dipilih");
    return;
  }

  if (!confirm("Yakin ingin menghapus file ini?")) return;

  const tx = db.transaction("files", "readwrite");
  const store = tx.objectStore("files");

  store.delete(currentId);

  tx.oncomplete = () => {
    currentId = null;
    document.getElementById("editor").innerHTML = "";
    loadFiles();
    alert("File dihapus");
  };
}

function loadFiles() {
  const select = document.getElementById("fileList");
  select.innerHTML = '<option value="">Open...</option>';

  const tx = db.transaction("files", "readonly");
  const store = tx.objectStore("files");

  let i = 1;
  store.openCursor().onsuccess = e => {
    const cursor = e.target.result;
    if (cursor) {
      const opt = document.createElement("option");
      opt.value = cursor.value.id;
      opt.textContent = "File " + i++;
      select.appendChild(opt);
      cursor.continue();
    }
  };
}

function getData() {
  return {
    html: document.getElementById("editor").innerHTML
  };
}
</script>

</body>
</html>
